(function(f){var g={init:function(a){var b=this;if(b.data("jqv")===undefined){g._saveOptions(b,a);f(".formError").live("click",function(){f(this).fadeOut(150,function(){f(this).remove()})})}},attach:function(){var a=this,b=a.data("jqv");if(!b.binded){a.find("[class*=validate]").not("[type=checkbox]").bind(b.validationEventTrigger,g._onFieldEvent);a.find("[class*=validate][type=checkbox]").bind("click",g._onFieldEvent);a.bind("submit",g._onSubmitEvent);b.binded=true}},detach:function(){var a=this,
b=a.data("jqv");if(b.binded){a.find("[class*=validate]").not("[type=checkbox]").unbind(b.validationEventTrigger,g._onFieldEvent);a.find("[class*=validate][type=checkbox]").unbind("click",g._onFieldEvent);a.unbind("submit",g._onSubmitEvent);a.removeData("jqv")}},validate:function(){return g._validateFields(this)},validateform:function(){return g._onSubmitEvent(this)},showPrompt:function(a,b,d,c){var e=this.closest("form").data("jqv");if(!d)e.promptPosition=d;e.showArrow=c===true;g._showPrompt(this,
a,b,false,e)},hide:function(){this.find(".formError").fadeTo("fast",0.3,function(){f(this).remove()})},hideAll:function(){f(".formError").fadeTo("fast",0.3,function(){f(this).remove()})},_onFieldEvent:function(){var a=f(this),b=a.closest("form").data("jqv");g._validateField(a,b)},_onSubmitEvent:function(){var a=f(this),b=g._validateFields(a,true),d=a.data("jqv");if(b&&d.ajaxFormValidationURL)g._validateFormWithAjax(a,d);else return b},_checkAjaxStatus:function(a){var b=true;f.each(a.ajaxValidCache,
function(d,c){if(c===false)return b=false});return b},_validateFields:function(a,b){var d=a.data("jqv"),c=false;a.find("[class*=validate]").each(function(){var i=f(this);i.hasClass("ajaxed")||(c|=g._validateField(i,d,b))});c|=!g._checkAjaxStatus(d);if(c){if(d.scroll){var e=Number.MAX_VALUE;a=a.find(".formError:not('.greenPopup')");for(var h=0;h<a.length;h++){var j=f(a[h]).offset().top;if(j<e)e=j}if(d.isOverflown){h=f(d.overflownDIV);a=h.scrollTop();h=-parseInt(h.offset().top);e+=a+h-5;f(d.overflownDIV+
":not(:animated)").animate({scrollTop:e},1100)}else f("html:not(:animated),body:not(:animated)").animate({scrollTop:e},1100)}return false}return true},_validateFormWithAjax:function(a,b){var d=a.serialize();f.ajax({type:"GET",url:b.ajaxFormValidationURL,cache:false,dataType:"json",data:d,form:a,methods:g,options:b,beforeSend:function(){},error:function(c,e){alert("ajax error: "+c.status+" "+e)},success:function(c){alert(c);c===true?b.onAjaxFormComplete(true,a,"",b):b.onAjaxFormComplete(false,a,c,
b)}})},_validateField:function(a,b,d){a.attr("id")||f.error("jQueryValidate: an ID attribute is required for this field: "+a.attr("name")+" class:"+a.attr("class"));var c=/\[(.*)\]/.exec(a.attr("class"));if(c===null)return false;var e=c[1].split(/\[|,|\]/);c=false;var h=a.attr("name"),j="";b.isError=false;b.showArrow=true;for(var i=0;i<e.length;i++){var k=undefined;switch(e[i]){case "optional":if(!a.val()){g._closePrompt(a);return b.isError}break;case "required":k=g._required(a,e,i,b);break;case "custom":k=
g._customRegex(a,e,i,b);break;case "ajax":if(!d){g._ajax(a,e,i,b);c=true}break;case "length":k=g._length(a,e,i,b);break;case "maxCheckbox":k=g._maxCheckbox(a,e,i,b);a=f(f("input[name='"+h+"']"));break;case "minCheckbox":k=g._minCheckbox(a,e,i,b);a=f(f("input[name='"+h+"']"));break;case "equals":k=g._equals(a,e,i,b);break;case "funcCall":k=g._funcCall(a,e,i,b);break;default:}if(k!==undefined){j+=k+"<br/>";b.isError=true}}d=a.attr("type");if((d=="radio"||d=="checkbox")&&f("input[name='"+h+"']").size()>
1){a=f(f("input[name='"+h+"'][type!=hidden]:first"));b.showArrow=false}c||(b.isError?g._showPrompt(a,j,"",false,b):g._closePrompt(a));return b.isError},_required:function(a,b,d,c){switch(a.attr("type")){case "text":case "password":case "textarea":if(!a.val())return c.allrules[b[d]].alertText;break;case "radio":case "checkbox":a=a.attr("name");if(f("input[name='"+a+"']:checked").size()===0)return f("input[name='"+a+"']").size()===1?c.allrules[b[d]].alertTextCheckboxe:c.allrules[b[d]].alertTextCheckboxMultiple;
break;case "select-one":if(!a.val())return c.allrules[b[d]].alertText;break;case "select-multiple":if(!a.find("option:selected").val())return c.allrules[b[d]].alertText;break}},_customRegex:function(a,b,d,c){b=b[d+1];if(!(new RegExp(c.allrules[b].regex)).test(a.attr("value")))return c.allrules[b].alertText},_funcCall:function(a,b,d,c){var e=window[b[d+1]];if(typeof e==="function")return e(a,b,d,c)},_equals:function(a,b,d,c){b=b[d+1];if(a.attr("value")!=f("#"+b).attr("value"))return c.allrules.equals.alertText},
_length:function(a,b,d,c){var e=b[d+1];b=b[d+2];a=a.attr("value").length;if(a<e||a>b){c=c.allrules.length;return c.alertText+e+c.alertText2+b+c.alertText3}},_maxCheckbox:function(a,b,d,c){b=b[d+1];a=a.attr("name");if(f("input[name='"+a+"']:checked").size()>b){c.showArrow=false;return c.allrules.maxCheckbox.alertText}},_minCheckbox:function(a,b,d,c){b=b[d+1];a=a.attr("name");if(f("input[name='"+a+"']:checked").size()<b){c.showArrow=false;return c.allrules.minCheckbox.alertText+" "+b+" "+c.allrules.minCheckbox.alertText2}},
_ajax:function(a,b,d,c){var e=c.allrules[b[d+1]];(b=e.extraData)||(b="");c.isError||f.ajax({type:"GET",url:e.url,cache:false,dataType:"json",data:"fieldId="+a.attr("id")+"&fieldValue="+a.attr("value")+"&extraData="+b,field:a,rule:e,methods:g,options:c,beforeSend:function(){var h=e.alertTextLoad;h&&g._showPrompt(a,h,"load",true,c)},error:function(h,j){h.status==0&&j==null?alert("The page is not served from a server! ajax call failed"):alert("Ajax error: "+h.status+" "+j)},success:function(h){var j=
h.jsonValidateReturn[0],i=f(f("#"+j)[0]);if(h.jsonValidateReturn[1]===false){c.ajaxValidCache[j]=false;c.isError=true;g._showPrompt(i,e.alertText,"",true,c)}else{if(c.ajaxValidCache[j]!==undefined)c.ajaxValidCache[j]=true;(h=e.alertTextOk)?g._showPrompt(i,h,"pass",true,c):g._closePrompt(i)}}})},_showPrompt:function(a,b,d,c,e){var h=g._getPrompt(a);h?g._updatePrompt(a,h,b,d,c,e):g._buildPrompt(a,b,d,c,e)},_buildPrompt:function(a,b,d,c,e){prompt=f("<div>");prompt.addClass(a.attr("id")+"formError");
prompt.addClass("formError");switch(d){case "pass":prompt.addClass("greenPopup");break;case "load":prompt.addClass("blackPopup")}c&&prompt.addClass("ajaxed");f("<div>").addClass("formErrorContent").html(b).appendTo(prompt);if(e.showArrow){b=f("<div>").addClass("formErrorArrow");prompt.append(b);switch(e.promptPosition){case "bottomLeft":case "bottomRight":b.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --\></div><div class="line2"><!-- --\></div><div class="line3"><!-- --\></div><div class="line4"><!-- --\></div><div class="line5"><!-- --\></div><div class="line6"><!-- --\></div><div class="line7"><!-- --\></div><div class="line8"><!-- --\></div><div class="line9"><!-- --\></div><div class="line10"><!-- --\></div>');
break;case "topLeft":case "topRight":b.html('<div class="line10"><!-- --\></div><div class="line9"><!-- --\></div><div class="line8"><!-- --\></div><div class="line7"><!-- --\></div><div class="line6"><!-- --\></div><div class="line5"><!-- --\></div><div class="line4"><!-- --\></div><div class="line3"><!-- --\></div><div class="line2"><!-- --\></div><div class="line1"><!-- --\></div>');break}}a.before(prompt);a=g._calculatePosition(a,prompt,e);prompt.css({top:a.callerTopPosition,left:a.callerleftPosition,
marginTop:a.marginTopSize,opacity:0});return prompt.animate({opacity:0.87})},_updatePrompt:function(a,b,d,c,e,h){if(b){c=="pass"?b.addClass("greenPopup"):b.removeClass("greenPopup");c=="load"?b.addClass("blackPopup"):b.removeClass("blackPopup");e?b.addClass("ajaxed"):b.removeClass("ajaxed");b.find(".formErrorContent").html(d);a=g._calculatePosition(a,b,h);b.animate({top:a.callerTopPosition,marginTop:a.marginTopSize})}},_closePrompt:function(a){var b=g._getPrompt(a);b&&b.fadeTo("fast",0,function(){b.remove()})},
_getPrompt:function(a){a="."+a.attr("id")+"formError";a=a.replace(/\[/g,"").replace(/\]/g,"");if(a=f(a)[0])return f(a)},_calculatePosition:function(a,b,d){var c,e,h=a.width(),j=b.height(),i=d.isOverflown;if(i){b=c=0;e=-j}else{c=a.offset();b=c.top;c=c.left;e=0}switch(d.promptPosition){default:case "topRight":if(i)c+=h-30;else{c+=h-30;b+=-j}break;case "topLeft":b+=-j-10;break;case "centerRight":c+=h+13;break;case "bottomLeft":b=b+a.height()+15;break;case "bottomRight":c+=h-30;b+=a.height()+5}return{callerTopPosition:b+
"px",callerleftPosition:c+"px",marginTopSize:e+"px"}},_saveOptions:function(a,b){if(f.validationEngineLanguage)var d=f.validationEngineLanguage.allRules;else f.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");b=f.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",ajaxFormValidationURL:undefined,onAjaxFormComplete:f.noop,onBeforeAjaxFormValidation:f.noop,isOverflown:false,overflownDIV:"",allrules:d,binded:false,showArrow:true,isError:false,
ajaxValidCache:{}},b);a.data("jqv",b);return b}};f.fn.validationEngine=function(a){var b=f(this);if(typeof a==="string"&&a.charAt(0)!="_"&&g[a]){g.init.apply(b);return g[a].apply(b,Array.prototype.slice.call(arguments,1))}else if(typeof a==="object"||!a)return g.init.apply(b,arguments);else f.error("Method "+a+" does not exist in jQuery.validationEngine")}})(jQuery);
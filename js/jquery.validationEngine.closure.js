(function(f){var g={init:function(b){var a=this;if(a.data("jqv")===undefined){g._saveOptions(a,b);f(".formError").live("click",function(){f(this).fadeOut(150,function(){f(this).remove()})})}},attach:function(){var b=this,a=b.data("jqv");if(!a.binded){b.find("[class*=validate]").not("[type=checkbox]").bind(a.validationEventTrigger,g._onFieldEvent);b.find("[class*=validate][type=checkbox]").bind("click",g._onFieldEvent);b.bind("submit",g._onSubmitEvent);a.binded=true}},detach:function(){var b=this,
a=b.data("jqv");if(a.binded){b.find("[class*=validate]").not("[type=checkbox]").unbind(a.validationEventTrigger,g._onFieldEvent);b.find("[class*=validate][type=checkbox]").unbind("click",g._onFieldEvent);b.unbind("submit",g._onSubmitEvent);b.removeData("jqv")}},validate:function(){return g._validateFields(this)},validateform:function(){return g._onSubmitEvent(this)},showPrompt:function(b,a,d,c){var e=this.closest("form").data("jqv");if(!d)e.promptPosition=d;e.showArrow=c===true;g._showPrompt(this,
b,a,false,e)},hide:function(){this.find(".formError").fadeTo("fast",0.3,function(){f(this).remove()})},hideAll:function(){f(".formError").fadeTo("fast",0.3,function(){f(this).remove()})},_onFieldEvent:function(){var b=f(this),a=b.closest("form").data("jqv");g._validateField(b,a)},_onSubmitEvent:function(){var b=f(this),a=g._validateFields(b,true),d=b.data("jqv");if(a&&d.ajaxFormValidationURL){g._validateFormWithAjax(b,d);return false}return a},_checkAjaxStatus:function(b){var a=true;f.each(b.ajaxValidCache,
function(d,c){if(c===false)return a=false});return a},_validateFields:function(b,a){var d=b.data("jqv"),c=false;b.find("[class*=validate]").each(function(){var i=f(this);i.hasClass("ajaxed")||(c|=g._validateField(i,d,a))});c|=!g._checkAjaxStatus(d);if(c){if(d.scroll){var e=Number.MAX_VALUE;b=b.find(".formError:not('.greenPopup')");for(var h=0;h<b.length;h++){var j=f(b[h]).offset().top;if(j<e)e=j}if(d.isOverflown){h=f(d.overflownDIV);b=h.scrollTop();h=-parseInt(h.offset().top);e+=b+h-5;f(d.overflownDIV+
":not(:animated)").animate({scrollTop:e},1100)}else f("html:not(:animated),body:not(:animated)").animate({scrollTop:e},1100)}return false}return true},_validateFormWithAjax:function(b,a){var d=b.serialize();f.ajax({type:"GET",url:a.ajaxFormValidationURL,cache:false,dataType:"json",data:d,form:b,methods:g,options:a,beforeSend:function(){return a.onBeforeAjaxFormValidation(b,a)},error:function(c,e){g._ajaxError(c,e)},success:function(c){if(c!==true){for(var e=false,h=0;h<c.length;h++){var j=c[h],i=
f(f("#"+j[0])[0]);if(i.length==1){var k=j[2];if(j[1]===true)if(k=="")g._closePrompt(i);else{if(a.allrules[k])if(j=a.allrules[k].alertTextOk)k=j;g._showPrompt(i,k,"pass",false,a)}else{e|=true;if(a.allrules[k])if(j=a.allrules[k].alertText)k=j;g._showPrompt(i,k,"",false,a)}}}a.onAjaxFormComplete(!e,b,c,a)}else a.onAjaxFormComplete(true,b,"",a)}})},_validateField:function(b,a,d){b.attr("id")||f.error("jQueryValidate: an ID attribute is required for this field: "+b.attr("name")+" class:"+b.attr("class"));
var c=/\[(.*)\]/.exec(b.attr("class"));if(c===null)return false;var e=c[1].split(/\[|,|\]/);c=false;var h=b.attr("name"),j="";a.isError=false;a.showArrow=true;for(var i=0;i<e.length;i++){var k=undefined;switch(e[i]){case "optional":if(!b.val()){g._closePrompt(b);return a.isError}break;case "required":k=g._required(b,e,i,a);break;case "custom":k=g._customRegex(b,e,i,a);break;case "ajax":if(!d){g._ajax(b,e,i,a);c=true}break;case "length":k=g._length(b,e,i,a);break;case "maxCheckbox":k=g._maxCheckbox(b,
e,i,a);b=f(f("input[name='"+h+"']"));break;case "minCheckbox":k=g._minCheckbox(b,e,i,a);b=f(f("input[name='"+h+"']"));break;case "equals":k=g._equals(b,e,i,a);break;case "funcCall":k=g._funcCall(b,e,i,a);break;default:}if(k!==undefined){j+=k+"<br/>";a.isError=true}}d=b.attr("type");if((d=="radio"||d=="checkbox")&&f("input[name='"+h+"']").size()>1){b=f(f("input[name='"+h+"'][type!=hidden]:first"));a.showArrow=false}c||(a.isError?g._showPrompt(b,j,"",false,a):g._closePrompt(b));return a.isError},_required:function(b,
a,d,c){switch(b.attr("type")){case "text":case "password":case "textarea":if(!b.val())return c.allrules[a[d]].alertText;break;case "radio":case "checkbox":b=b.attr("name");if(f("input[name='"+b+"']:checked").size()===0)return f("input[name='"+b+"']").size()===1?c.allrules[a[d]].alertTextCheckboxe:c.allrules[a[d]].alertTextCheckboxMultiple;break}},_customRegex:function(b,a,d,c){a=a[d+1];if(!(new RegExp(c.allrules[a].regex)).test(b.attr("value")))return c.allrules[a].alertText},_funcCall:function(b,
a,d,c){var e=window[a[d+1]];if(typeof e==="function")return e(b,a,d,c)},_equals:function(b,a,d,c){a=a[d+1];if(b.attr("value")!=f("#"+a).attr("value"))return c.allrules.equals.alertText},_length:function(b,a,d,c){var e=a[d+1];a=a[d+2];b=b.attr("value").length;if(b<e||b>a){c=c.allrules.length;return c.alertText+e+c.alertText2+a+c.alertText3}},_maxCheckbox:function(b,a,d,c){a=a[d+1];b=b.attr("name");if(f("input[name='"+b+"']:checked").size()>a){c.showArrow=false;return c.allrules.maxCheckbox.alertText}},
_minCheckbox:function(b,a,d,c){a=a[d+1];b=b.attr("name");if(f("input[name='"+b+"']:checked").size()<a){c.showArrow=false;return c.allrules.minCheckbox.alertText+" "+a+" "+c.allrules.minCheckbox.alertText2}},_ajax:function(b,a,d,c){var e=c.allrules[a[d+1]];(a=e.extraData)||(a="");c.isError||f.ajax({type:"GET",url:e.url,cache:false,dataType:"json",data:"fieldId="+b.attr("id")+"&fieldValue="+b.attr("value")+"&extraData="+a,field:b,rule:e,methods:g,options:c,beforeSend:function(){var h=e.alertTextLoad;
h&&g._showPrompt(b,h,"load",true,c)},error:function(h,j){g._ajaxError(h,j)},success:function(h){var j=h[0],i=f(f("#"+j)[0]);if(i.length==1)if(h[1]===false){c.ajaxValidCache[j]=false;c.isError=true;g._showPrompt(i,e.alertText,"",true,c)}else{if(c.ajaxValidCache[j]!==undefined)c.ajaxValidCache[j]=true;(h=e.alertTextOk)?g._showPrompt(i,h,"pass",true,c):g._closePrompt(i)}}})},_ajaxError:function(b,a){if(b.status===0&&a===null)alert("The page is not served from a server! ajax call failed");else console&&
console.log("Ajax error: "+b.status+" "+a)},_showPrompt:function(b,a,d,c,e){var h=g._getPrompt(b);h?g._updatePrompt(b,h,a,d,c,e):g._buildPrompt(b,a,d,c,e)},_buildPrompt:function(b,a,d,c,e){prompt=f("<div>");prompt.addClass(b.attr("id")+"formError");prompt.addClass("formError");switch(d){case "pass":prompt.addClass("greenPopup");break;case "load":prompt.addClass("blackPopup")}c&&prompt.addClass("ajaxed");f("<div>").addClass("formErrorContent").html(a).appendTo(prompt);if(e.showArrow){a=f("<div>").addClass("formErrorArrow");
prompt.append(a);switch(e.promptPosition){case "bottomLeft":case "bottomRight":a.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --\></div><div class="line2"><!-- --\></div><div class="line3"><!-- --\></div><div class="line4"><!-- --\></div><div class="line5"><!-- --\></div><div class="line6"><!-- --\></div><div class="line7"><!-- --\></div><div class="line8"><!-- --\></div><div class="line9"><!-- --\></div><div class="line10"><!-- --\></div>');break;case "topLeft":case "topRight":a.html('<div class="line10"><!-- --\></div><div class="line9"><!-- --\></div><div class="line8"><!-- --\></div><div class="line7"><!-- --\></div><div class="line6"><!-- --\></div><div class="line5"><!-- --\></div><div class="line4"><!-- --\></div><div class="line3"><!-- --\></div><div class="line2"><!-- --\></div><div class="line1"><!-- --\></div>');
break}}b.before(prompt);b=g._calculatePosition(b,prompt,e);prompt.css({top:b.callerTopPosition,left:b.callerleftPosition,marginTop:b.marginTopSize,opacity:0});return prompt.animate({opacity:0.87})},_updatePrompt:function(b,a,d,c,e,h){if(a){c=="pass"?a.addClass("greenPopup"):a.removeClass("greenPopup");c=="load"?a.addClass("blackPopup"):a.removeClass("blackPopup");e?a.addClass("ajaxed"):a.removeClass("ajaxed");a.find(".formErrorContent").html(d);b=g._calculatePosition(b,a,h);a.animate({top:b.callerTopPosition,
marginTop:b.marginTopSize})}},_closePrompt:function(b){var a=g._getPrompt(b);a&&a.fadeTo("fast",0,function(){a.remove()})},_getPrompt:function(b){b="."+b.attr("id")+"formError";if(b=f(b)[0])return f(b)},_calculatePosition:function(b,a,d){var c,e,h=b.width(),j=a.height(),i=d.isOverflown;if(i){a=c=0;e=-j}else{c=b.offset();a=c.top;c=c.left;e=0}switch(d.promptPosition){default:case "topRight":if(i)c+=h-30;else{c+=h-30;a+=-j}break;case "topLeft":a+=-j-10;break;case "centerRight":c+=h+13;break;case "bottomLeft":a=
a+b.height()+15;break;case "bottomRight":c+=h-30;a+=b.height()+5}return{callerTopPosition:a+"px",callerleftPosition:c+"px",marginTopSize:e+"px"}},_saveOptions:function(b,a){if(f.validationEngineLanguage)var d=f.validationEngineLanguage.allRules;else f.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");a=f.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",ajaxFormValidationURL:undefined,onAjaxFormComplete:f.noop,onBeforeAjaxFormValidation:f.noop,
isOverflown:false,overflownDIV:"",allrules:d,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},a);b.data("jqv",a);return a}};f.fn.validationEngine=function(b){var a=f(this);if(typeof b==="string"&&b.charAt(0)!="_"&&g[b]){g.init.apply(a);return g[b].apply(a,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b)return g.init.apply(a,arguments);else f.error("Method "+b+" does not exist in jQuery.validationEngine")}})(jQuery);
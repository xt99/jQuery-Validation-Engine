(function(e){var f={init:function(a){var b=this;if(b.data("jqv")===undefined){f._saveOptions(b,a);e(".formError").live("click",function(){e(this).fadeOut(150,function(){e(this).remove()})})}},attach:function(){var a=this,b=a.data("jqv");if(!b.binded){a.find("[class*=validate]").not("[type=checkbox]").bind(b.validationEventTrigger,f._onFieldEvent);a.find("[class*=validate][type=checkbox]").bind("click",f._onFieldEvent);a.bind("submit",f._onSubmitEvent);b.binded=true}},detach:function(){var a=this,
b=a.data("jqv");if(b.binded){a.find("[class*=validate]").not("[type=checkbox]").unbind(b.validationEventTrigger,f._onFieldEvent);a.find("[class*=validate][type=checkbox]").unbind("click",f._onFieldEvent);a.unbind("submit",f._onSubmitEvent);a.removeData("jqv")}},validate:function(){return f._validateForm(this)},showPrompt:function(a,b){var d=this.closest("form").data("jqv");f._showPrompt(this,a,b,false,d)},hide:function(){this.find(".formError").fadeTo("fast",0.3,function(){e(this).remove()})},hideAll:function(){e(".formError").fadeTo("fast",
0.3,function(){e(this).remove()})},_onFieldEvent:function(){var a=e(this),b=a.closest("form").data("jqv");f._validateField(a,b)},_checkAjaxStatus:function(a){var b=true;e.each(a.ajaxValidCache,function(d,c){if(c===false)return b=false});return b},_onSubmitEvent:function(){var a=e(this);if(f._validateForm(a)===false){a.data("jqv").onFailure();return false}},_validateForm:function(a){var b=a.data("jqv"),d=false;a.find("[class*=validate]").each(function(){var h=e(this);h.hasClass("ajaxed")||(d|=f._validateField(h,
b))});d|=!f._checkAjaxStatus(b);if(d){if(b.scroll){var c=Number.MAX_VALUE;a=a.find(".formError:not('.greenPopup')");for(var g=0;g<a.length;g++){var i=e(a[g]).offset().top;if(i<c)c=i}if(b.isOverflown){g=e(b.overflownDIV);a=g.scrollTop();g=-parseInt(g.offset().top);c+=a+g-5;e(b.overflownDIV+":not(:animated)").animate({scrollTop:c},1100)}else e("html:not(:animated),body:not(:animated)").animate({scrollTop:c},1100)}return false}return true},_validateField:function(a,b){var d=/\[(.*)\]/.exec(a.attr("class"));
if(d===null)return false;d=d[1].split(/\[|,|\]/);return f._validateRules(a,d,b)},_validateRules:function(a,b,d){a.attr("id")||e.error("jQueryValidate: an ID attribute is required for this field: "+a.attr("name")+" class:"+a.attr("class"));var c=false,g=a.attr("name"),i="";d.isError=false;d.showArrow=true;for(var h=0;h<b.length;h++){var j=undefined;switch(b[h]){case "optional":if(!a.val()){f._closePrompt(a);return d.isError}break;case "required":j=f._required(a,b,h,d);break;case "custom":j=f._customRegex(a,
b,h,d);break;case "ajax":f._ajax(a,b,h,d);c=true;break;case "length":j=f._length(a,b,h,d);break;case "maxCheckbox":j=f._maxCheckbox(a,b,h,d);a=e(e("input[name='"+g+"']"));break;case "minCheckbox":j=f._minCheckbox(a,b,h,d);a=e(e("input[name='"+g+"']"));break;case "equals":j=f._equals(a,b,h,d);break;case "funcCall":j=f._funcCall(a,b,h,d);break;default:}if(j!==undefined){i+=j+"<br/>";d.isError=true}}b=a.attr("type");if((b=="radio"||b=="checkbox")&&e("input[name='"+g+"']").size()>1){a=e(e("input[name='"+
g+"'][type!=hidden]:first"));d.showArrow=false}c||(d.isError?f._showPrompt(a,i,"",false,d):f._closePrompt(a));return d.isError},_required:function(a,b,d,c){switch(a.attr("type")){case "text":case "password":case "textarea":if(!a.val())return c.allrules[b[d]].alertText;break;case "radio":case "checkbox":a=a.attr("name");if(e("input[name='"+a+"']:checked").size()===0)return e("input[name='"+a+"']").size()===1?c.allrules[b[d]].alertTextCheckboxe:c.allrules[b[d]].alertTextCheckboxMultiple;break;case "select-one":if(!a.val())return c.allrules[b[d]].alertText;
break;case "select-multiple":if(!a.find("option:selected").val())return c.allrules[b[d]].alertText;break}},_customRegex:function(a,b,d,c){b=b[d+1];if(!(new RegExp(c.allrules[b].regex)).test(a.attr("value")))return c.allrules[b].alertText},_funcCall:function(a,b,d,c){var g=window[b[d+1]];if(typeof g==="function")return g(a,b,d,c)},_equals:function(a,b,d,c){b=b[d+1];if(a.attr("value")!=e("#"+b).attr("value"))return c.allrules.equals.alertText},_length:function(a,b,d,c){var g=b[d+1];b=b[d+2];a=a.attr("value").length;
if(a<g||a>b){c=c.allrules.length;return c.alertText+g+c.alertText2+b+c.alertText3}},_maxCheckbox:function(a,b,d,c){b=eval(b[d+1]);a=a.attr("name");if(e("input[name='"+a+"']:checked").size()>b){c.showArrow=false;return c.allrules.maxCheckbox.alertText}},_minCheckbox:function(a,b,d,c){b=eval(b[d+1]);a=a.attr("name");if(e("input[name='"+a+"']:checked").size()<b){c.showArrow=false;return c.allrules.minCheckbox.alertText+" "+b+" "+c.allrules.minCheckbox.alertText2}},_ajax:function(a,b,d,c){var g=c.allrules[b[d+
1]];(b=g.extraData)||(b="");c.isError||e.ajax({type:"GET",url:g.url,data:"fieldId="+a.attr("id")+"&fieldValue="+a.attr("value")+"&extraData="+b,field:a,rule:g,methods:f,options:c,beforeSend:function(){var i=g.alertTextLoad;i&&f._showPrompt(a,i,"load",true,c)},error:function(i,h){alert("ajax error: "+i.status+" "+h)},success:function(i){var h=i.jsonValidateReturn[0],j=e(e("#"+h)[0]);if(i.jsonValidateReturn[1]===false){c.ajaxValidCache[h]=false;c.isError=true;f._showPrompt(j,g.alertText,"",true,c)}else{if(c.ajaxValidCache[h]!==
undefined)c.ajaxValidCache[h]=true;(i=g.alertTextOk)?f._showPrompt(j,i,"pass",true,c):f._closePrompt(j)}}})},_showPrompt:function(a,b,d,c,g){var i=f._getPrompt(a);i?f._updatePrompt(a,i,b,d,c,g):f._buildPrompt(a,b,d,c,g)},_buildPrompt:function(a,b,d,c,g){prompt=e("<div>");prompt.addClass(a.attr("id")+"formError");prompt.addClass("formError");switch(d){case "pass":prompt.addClass("greenPopup");break;case "load":prompt.addClass("blackPopup")}c&&prompt.addClass("ajaxed");e("<div>").addClass("formErrorContent").html(b).appendTo(prompt);
if(g.showArrow){b=e("<div>").addClass("formErrorArrow");prompt.append(b);switch(g.promptPosition){case "bottomLeft":case "bottomRight":b.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --\></div><div class="line2"><!-- --\></div><div class="line3"><!-- --\></div><div class="line4"><!-- --\></div><div class="line5"><!-- --\></div><div class="line6"><!-- --\></div><div class="line7"><!-- --\></div><div class="line8"><!-- --\></div><div class="line9"><!-- --\></div><div class="line10"><!-- --\></div>');
break;case "topLeft":case "topRight":b.html('<div class="line10"><!-- --\></div><div class="line9"><!-- --\></div><div class="line8"><!-- --\></div><div class="line7"><!-- --\></div><div class="line6"><!-- --\></div><div class="line5"><!-- --\></div><div class="line4"><!-- --\></div><div class="line3"><!-- --\></div><div class="line2"><!-- --\></div><div class="line1"><!-- --\></div>');break}}a.before(prompt);a=f._calculatePosition(a,prompt,g);prompt.css({top:a.callerTopPosition,left:a.callerleftPosition,
marginTop:a.marginTopSize,opacity:0});return prompt.animate({opacity:0.87})},_updatePrompt:function(a,b,d,c,g,i){if(b){c=="pass"?b.addClass("greenPopup"):b.removeClass("greenPopup");c=="load"?b.addClass("blackPopup"):b.removeClass("blackPopup");g?b.addClass("ajaxed"):b.removeClass("ajaxed");b.find(".formErrorContent").html(d);a=f._calculatePosition(a,b,i);b.animate({top:a.callerTopPosition,marginTop:a.marginTopSize})}},_closePrompt:function(a){var b=f._getPrompt(a);b&&b.fadeTo("fast",0,function(){b.remove()})},
_getPrompt:function(a){a="."+a.attr("id")+"formError";a=a.replace(/\[/g,"").replace(/\]/g,"");if(a=e(a)[0])return e(a)},_calculatePosition:function(a,b,d){var c,g,i=a.width(),h=b.height(),j=d.isOverflown;if(j){b=c=0;g=-h}else{c=a.offset();b=c.top;c=c.left;g=0}switch(d.promptPosition){default:case "topRight":if(j)c+=i-30;else{c+=i-30;b+=-h}break;case "topLeft":b+=-h-10;break;case "centerRight":c+=i+13;break;case "bottomLeft":b=b+a.height()+15;break;case "bottomRight":c+=i-30;b+=a.height()+5}return{callerTopPosition:b+
"px",callerleftPosition:c+"px",marginTopSize:g+"px"}},_saveOptions:function(a,b){if(e.validationEngineLanguage)var d=e.validationEngineLanguage.allRules;else e.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");b=e.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",onFailure:e.noop,isOverflown:false,overflownDIV:"",ajaxSubmit:false,allrules:d,binded:false,showArrow:true,isError:false,success:false,ajaxValidCache:{}},b);a.data("jqv",
b);return b}};e.fn.validationEngine=function(a){var b=e(this);if(typeof a==="string"&&a.charAt(0)!="_"&&f[a]){f.init.apply(b);return f[a].apply(b,Array.prototype.slice.call(arguments,1))}else if(typeof a==="object"||!a)return f.init.apply(b,arguments);else e.error("Method "+a+" does not exist on jQuery.validationEngine")}})(jQuery);
(function(g){var f={init:function(a){var b=this;if(b.data("jqv")===undefined){f._saveOptions(b,a);g(".formError").live("click",function(){g(this).fadeOut(150,function(){g(this).remove()})})}},attach:function(){var a=this,b=a.data("jqv");if(!b.binded){a.find("[class*=validate]").not("[type=checkbox]").bind(b.validationEventTrigger,f._onFieldEvent);a.find("[class*=validate][type=checkbox]").bind("click",f._onFieldEvent);a.bind("submit",f._onSubmitEvent);b.binded=true}},detach:function(){var a=this,
b=a.data("jqv");if(b.binded){a.find("[class*=validate]").not("[type=checkbox]").unbind(b.validationEventTrigger,f._onFieldEvent);a.find("[class*=validate][type=checkbox]").unbind("click",f._onFieldEvent);a.unbind("submit",f._onSubmitEvent);a.removeData("jqv")}},validate:function(){return f._validateFields(this)},validateform:function(){return f._onSubmitEvent(this)},showPrompt:function(a,b,d,c){var e=this.closest("form").data("jqv");if(!d)e.promptPosition=d;e.showArrow=c===true;f._showPrompt(this,
a,b,false,e)},hide:function(){this.find(".formError").fadeTo("fast",0.3,function(){g(this).remove()})},hideAll:function(){g(".formError").fadeTo("fast",0.3,function(){g(this).remove()})},_onFieldEvent:function(){var a=g(this),b=a.closest("form").data("jqv");f._validateField(a,b)},_onSubmitEvent:function(){var a=g(this),b=f._validateFields(a,true),d=a.data("jqv");if(b&&d.ajaxFormValidationURL){f._validateFormWithAjax(a,d);return false}return b},_checkAjaxStatus:function(a){var b=true;g.each(a.ajaxValidCache,
function(d,c){if(c===false)return b=false});return b},_validateFields:function(a,b){var d=a.data("jqv"),c=false;a.find("[class*=validate]").each(function(){var i=g(this);i.hasClass("ajaxed")||(c|=f._validateField(i,d,b))});c|=!f._checkAjaxStatus(d);if(c){if(d.scroll){var e=Number.MAX_VALUE;a=a.find(".formError:not('.greenPopup')");for(var h=0;h<a.length;h++){var j=g(a[h]).offset().top;if(j<e)e=j}if(d.isOverflown){h=g(d.overflownDIV);a=h.scrollTop();h=-parseInt(h.offset().top);e+=a+h-5;g(d.overflownDIV+
":not(:animated)").animate({scrollTop:e},1100)}else g("html:not(:animated),body:not(:animated)").animate({scrollTop:e},1100)}return false}return true},_validateFormWithAjax:function(a,b){var d=a.serialize();g.ajax({type:"GET",url:b.ajaxFormValidationURL,cache:false,dataType:"json",data:d,form:a,methods:f,options:b,beforeSend:function(){return b.onBeforeAjaxFormValidation(a,b)},error:function(c,e){f._ajaxError(c,e)},success:function(c){if(c!==true){for(var e=false,h=0;h<c.length;h++){var j=c[h],i=
g(g("#"+j[0])[0]);if(i.length==1){var k=j[2];if(j[1]===true)if(k=="")f._closePrompt(i);else{if(b.allrules[k])if(j=b.allrules[k].alertTextOk)k=j;f._showPrompt(i,k,"pass",false,b)}else{e|=true;if(b.allrules[k])if(j=b.allrules[k].alertText)k=j;f._showPrompt(i,k,"",false,b)}}}b.onAjaxFormComplete(!e,a,c,b)}else b.onAjaxFormComplete(true,a,"",b)}})},_validateField:function(a,b,d){a.attr("id")||g.error("jQueryValidate: an ID attribute is required for this field: "+a.attr("name")+" class:"+a.attr("class"));
var c=/\[(.*)\]/.exec(a.attr("class"));if(c===null)return false;var e=c[1].split(/\[|,|\]/);c=false;var h=a.attr("name"),j="";b.isError=false;b.showArrow=true;for(var i=0;i<e.length;i++){var k=undefined;switch(e[i]){case "optional":if(!a.val()){f._closePrompt(a);return b.isError}break;case "required":k=f._required(a,e,i,b);break;case "custom":k=f._customRegex(a,e,i,b);break;case "ajax":if(!d){f._ajax(a,e,i,b);c=true}break;case "minSize":k=f._minSize(a,e,i,b);break;case "maxSize":k=f._maxSize(a,e,
i,b);break;case "min":k=f._min(a,e,i,b);break;case "max":k=f._max(a,e,i,b);break;case "maxCheckbox":k=f._maxCheckbox(a,e,i,b);a=g(g("input[name='"+h+"']"));break;case "minCheckbox":k=f._minCheckbox(a,e,i,b);a=g(g("input[name='"+h+"']"));break;case "equals":k=f._equals(a,e,i,b);break;case "funcCall":k=f._funcCall(a,e,i,b);break;default:}if(k!==undefined){j+=k+"<br/>";b.isError=true}}d=a.attr("type");if((d=="radio"||d=="checkbox")&&g("input[name='"+h+"']").size()>1){a=g(g("input[name='"+h+"'][type!=hidden]:first"));
b.showArrow=false}c||(b.isError?f._showPrompt(a,j,"",false,b):f._closePrompt(a));return b.isError},_required:function(a,b,d,c){switch(a.attr("type")){case "text":case "password":case "textarea":if(!a.val())return c.allrules[b[d]].alertText;break;case "radio":case "checkbox":a=a.attr("name");if(g("input[name='"+a+"']:checked").size()===0)return g("input[name='"+a+"']").size()===1?c.allrules[b[d]].alertTextCheckboxe:c.allrules[b[d]].alertTextCheckboxMultiple;break}},_customRegex:function(a,b,d,c){b=
b[d+1];if(!(new RegExp(c.allrules[b].regex)).test(a.attr("value")))return c.allrules[b].alertText},_funcCall:function(a,b,d,c){var e=window[b[d+1]];if(typeof e==="function")return e(a,b,d,c)},_equals:function(a,b,d,c){b=b[d+1];if(a.attr("value")!=g("#"+b).attr("value"))return c.allrules.equals.alertText},_maxSize:function(a,b,d,c){b=b[d+1];if(a.attr("value").length>b){a=c.allrules.maxSize;return a.alertText+startLength+a.alertText2+endLength+a.alertText3}},_minSize:function(a,b,d,c){b=b[d+1];if(a.attr("value").length<
b){a=c.allrules.minSize;return a.alertText+startLength+a.alertText2+endLength+a.alertText3}},_min:function(a,b,d,c){b=parseFloat(b[d+1]);if(parseFloat(a.attr("value"))<b){a=c.allrules.min;return a.alertText+startLength+a.alertText2+endLength+a.alertText3}},_max:function(a,b,d,c){b=parseFloat(b[d+1]);if(parseFloat(a.attr("value"))>b){a=c.allrules.max;return a.alertText+startLength+a.alertText2+endLength+a.alertText3}},_maxCheckbox:function(a,b,d,c){b=b[d+1];a=a.attr("name");if(g("input[name='"+a+"']:checked").size()>
b){c.showArrow=false;return c.allrules.maxCheckbox.alertText}},_minCheckbox:function(a,b,d,c){b=b[d+1];a=a.attr("name");if(g("input[name='"+a+"']:checked").size()<b){c.showArrow=false;return c.allrules.minCheckbox.alertText+" "+b+" "+c.allrules.minCheckbox.alertText2}},_ajax:function(a,b,d,c){var e=c.allrules[b[d+1]];(b=e.extraData)||(b="");c.isError||g.ajax({type:"GET",url:e.url,cache:false,dataType:"json",data:"fieldId="+a.attr("id")+"&fieldValue="+a.attr("value")+"&extraData="+b,field:a,rule:e,
methods:f,options:c,beforeSend:function(){var h=e.alertTextLoad;h&&f._showPrompt(a,h,"load",true,c)},error:function(h,j){f._ajaxError(h,j)},success:function(h){var j=h[0],i=g(g("#"+j)[0]);if(i.length==1)if(h[1]===false){c.ajaxValidCache[j]=false;c.isError=true;f._showPrompt(i,e.alertText,"",true,c)}else{if(c.ajaxValidCache[j]!==undefined)c.ajaxValidCache[j]=true;(h=e.alertTextOk)?f._showPrompt(i,h,"pass",true,c):f._closePrompt(i)}}})},_ajaxError:function(a,b){if(a.status===0&&b===null)alert("The page is not served from a server! ajax call failed");
else console&&console.log("Ajax error: "+a.status+" "+b)},_showPrompt:function(a,b,d,c,e){var h=f._getPrompt(a);h?f._updatePrompt(a,h,b,d,c,e):f._buildPrompt(a,b,d,c,e)},_buildPrompt:function(a,b,d,c,e){prompt=g("<div>");prompt.addClass(a.attr("id")+"formError");prompt.addClass("formError");switch(d){case "pass":prompt.addClass("greenPopup");break;case "load":prompt.addClass("blackPopup")}c&&prompt.addClass("ajaxed");g("<div>").addClass("formErrorContent").html(b).appendTo(prompt);if(e.showArrow){b=
g("<div>").addClass("formErrorArrow");prompt.append(b);switch(e.promptPosition){case "bottomLeft":case "bottomRight":b.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --\></div><div class="line2"><!-- --\></div><div class="line3"><!-- --\></div><div class="line4"><!-- --\></div><div class="line5"><!-- --\></div><div class="line6"><!-- --\></div><div class="line7"><!-- --\></div><div class="line8"><!-- --\></div><div class="line9"><!-- --\></div><div class="line10"><!-- --\></div>');
break;case "topLeft":case "topRight":b.html('<div class="line10"><!-- --\></div><div class="line9"><!-- --\></div><div class="line8"><!-- --\></div><div class="line7"><!-- --\></div><div class="line6"><!-- --\></div><div class="line5"><!-- --\></div><div class="line4"><!-- --\></div><div class="line3"><!-- --\></div><div class="line2"><!-- --\></div><div class="line1"><!-- --\></div>');break}}a.before(prompt);a=f._calculatePosition(a,prompt,e);prompt.css({top:a.callerTopPosition,left:a.callerleftPosition,
marginTop:a.marginTopSize,opacity:0});return prompt.animate({opacity:0.87})},_updatePrompt:function(a,b,d,c,e,h){if(b){c=="pass"?b.addClass("greenPopup"):b.removeClass("greenPopup");c=="load"?b.addClass("blackPopup"):b.removeClass("blackPopup");e?b.addClass("ajaxed"):b.removeClass("ajaxed");b.find(".formErrorContent").html(d);a=f._calculatePosition(a,b,h);b.animate({top:a.callerTopPosition,marginTop:a.marginTopSize})}},_closePrompt:function(a){var b=f._getPrompt(a);b&&b.fadeTo("fast",0,function(){b.remove()})},
_getPrompt:function(a){a="."+a.attr("id")+"formError";if(a=g(a)[0])return g(a)},_calculatePosition:function(a,b,d){var c,e,h=a.width(),j=b.height(),i=d.isOverflown;if(i){b=c=0;e=-j}else{c=a.offset();b=c.top;c=c.left;e=0}switch(d.promptPosition){default:case "topRight":if(i)c+=h-30;else{c+=h-30;b+=-j}break;case "topLeft":b+=-j-10;break;case "centerRight":c+=h+13;break;case "bottomLeft":b=b+a.height()+15;break;case "bottomRight":c+=h-30;b+=a.height()+5}return{callerTopPosition:b+"px",callerleftPosition:c+
"px",marginTopSize:e+"px"}},_saveOptions:function(a,b){if(g.validationEngineLanguage)var d=g.validationEngineLanguage.allRules;else g.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");b=g.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",ajaxFormValidationURL:undefined,onAjaxFormComplete:g.noop,onBeforeAjaxFormValidation:g.noop,isOverflown:false,overflownDIV:"",allrules:d,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},
b);a.data("jqv",b);return b}};g.fn.validationEngine=function(a){var b=g(this);if(typeof a==="string"&&a.charAt(0)!="_"&&f[a]){f.init.apply(b);return f[a].apply(b,Array.prototype.slice.call(arguments,1))}else if(typeof a==="object"||!a)return f.init.apply(b,arguments);else g.error("Method "+a+" does not exist in jQuery.validationEngine")}})(jQuery);